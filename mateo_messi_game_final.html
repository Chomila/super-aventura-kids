<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mateo Gil - El Pequeño Messi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(90deg, #4CAF50 0%, #66BB6A 30%, #4CAF50 70%, #388E3C 100%);
        }

        #field {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.8) 1%, transparent 2%),
                linear-gradient(0deg, transparent 0%, rgba(255,255,255,0.8) 1%, transparent 2%),
                linear-gradient(90deg, transparent 49%, rgba(255,255,255,0.9) 50%, transparent 51%),
                linear-gradient(0deg, transparent 35%, rgba(255,255,255,0.6) 36%, transparent 37%),
                linear-gradient(0deg, transparent 63%, rgba(255,255,255,0.6) 64%, transparent 65%);
            background-size: 80px 80px, 80px 80px, 100% 3px, 100% 3px, 100% 3px;
        }

        #centerCircle {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255,255,255,0.8);
            border-radius: 50%;
        }

        #centerDot {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        #goal {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 100px;
            border: 4px solid white;
            border-right: none;
            background: linear-gradient(90deg, rgba(255,255,255,0.1), transparent);
            border-radius: 10px 0 0 10px;
        }

        #goalPost1, #goalPost2 {
            position: absolute;
            width: 6px;
            height: 15px;
            background: white;
            right: -3px;
        }

        #goalPost1 { top: -4px; }
        #goalPost2 { bottom: -4px; }

        #player {
            position: absolute;
            left: 80px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #FFE082, #FFD54F);
            border-radius: 50% 50% 45% 45%;
            border: 3px solid #FF7043;
            transition: all 0.2s ease;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        #player::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 12px;
            width: 16px;
            height: 12px;
            background: #8D6E63;
            border-radius: 50%;
        }

        #player::after {
            content: '⚽';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }

        #ball {
            position: absolute;
            left: 100px;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 30% 30%, white, #f0f0f0);
            border-radius: 50%;
            border: 2px solid #333;
            transition: all 0.3s ease;
            z-index: 5;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        }

        #ball::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 1px solid #666;
        }

        #topUI {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 20;
        }

        #score {
            background: linear-gradient(145deg, rgba(0,0,0,0.9), rgba(50,50,50,0.9));
            color: #FFD700;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid #FFD700;
        }

        #playerCard {
            background: linear-gradient(145deg, #1565C0, #1976D2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid #64B5F6;
        }

        #arrowControls {
            position: absolute;
            bottom: 60px;
            left: 25px;
            width: 150px;
            height: 150px;
            z-index: 20;
        }

        .arrow-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(50,50,50,0.8));
            border: 3px solid #FFD700;
            border-radius: 12px;
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            cursor: pointer;
        }

        .arrow-btn:active, .arrow-btn.pressed {
            background: linear-gradient(145deg, #FFD700, #FFC107);
            color: black;
            transform: scale(0.9);
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }

        #upBtn {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        #downBtn {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        #leftBtn {
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        #rightBtn {
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        #kickBtn {
            position: absolute;
            bottom: 60px;
            right: 25px;
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, #E53935, #F44336);
            border: 4px solid white;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            transition: all 0.2s ease;
            cursor: pointer;
            touch-action: manipulation;
        }

        #kickBtn:active, #kickBtn.pressed {
            background: linear-gradient(145deg, #FF5722, #FF6D00);
            transform: scale(0.95);
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
        }

        #kickBtn.ready {
            background: linear-gradient(145deg, #4CAF50, #66BB6A);
            border-color: #FFD700;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 6px 12px rgba(0,0,0,0.4), 0 0 0 0 rgba(255,215,0,0.7); }
            50% { box-shadow: 0 6px 12px rgba(0,0,0,0.4), 0 0 0 10px rgba(255,215,0,0); }
            100% { box-shadow: 0 6px 12px rgba(0,0,0,0.4), 0 0 0 0 rgba(255,215,0,0); }
        }

        #celebration {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #FFD700, #FFC107);
            color: #1565C0;
            padding: 25px 35px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            display: none;
            z-index: 100;
            border: 4px solid #1565C0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: celebrationPulse 0.5s ease;
        }

        @keyframes celebrationPulse {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        #goalkeeper {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 45px;
            height: 45px;
            background: linear-gradient(145deg, #FFC107, #FFD54F);
            border-radius: 50% 50% 40% 40%;
            border: 4px solid #FF5722;
            z-index: 9;
            transition: all 0.1s ease;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        #goalkeeper::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 10px;
            width: 20px;
            height: 14px;
            background: #795548;
            border-radius: 50%;
        }

        #goalkeeper::after {
            content: '🥅';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
        }

        .goalkeeper-dive {
            animation: goalkeepeDive 0.3s ease;
        }

        @keyframes goalkeepeDive {
            0% { transform: translateY(-50%) rotate(0deg) scale(1); }
            50% { transform: translateY(-50%) rotate(30deg) scale(1.5); }
            100% { transform: translateY(-50%) rotate(0deg) scale(1); }
        }

        .goalkeeper-super-save {
            animation: superSave 0.5s ease;
        }

        @keyframes superSave {
            0% { transform: translateY(-50%) scale(1); background: linear-gradient(145deg, #FFC107, #FFD54F); }
            20% { transform: translateY(-80%) scale(1.4); background: linear-gradient(145deg, #FF5722, #FF7043); }
            40% { transform: translateY(-20%) scale(1.4); background: linear-gradient(145deg, #FF5722, #FF7043); }
            60% { transform: translateY(-80%) scale(1.4); background: linear-gradient(145deg, #FF5722, #FF7043); }
            80% { transform: translateY(-20%) scale(1.4); background: linear-gradient(145deg, #FF5722, #FF7043); }
            100% { transform: translateY(-50%) scale(1); background: linear-gradient(145deg, #FFC107, #FFD54F); }
        }

        .goalkeeper-legendary {
            animation: legendaryMode 0.8s ease;
        }

        @keyframes legendaryMode {
            0% { transform: translateY(-50%) scale(1); filter: hue-rotate(0deg); }
            25% { transform: translateY(-60%) scale(1.6); filter: hue-rotate(90deg); }
            50% { transform: translateY(-40%) scale(1.6); filter: hue-rotate(180deg); }
            75% { transform: translateY(-60%) scale(1.6); filter: hue-rotate(270deg); }
            100% { transform: translateY(-50%) scale(1); filter: hue-rotate(360deg); }
        }

        #messiFacts {
            position: absolute;
            bottom: 15px;
            left: 15px;
            right: 15px;
            background: linear-gradient(145deg, rgba(21,101,192,0.95), rgba(25,118,210,0.95));
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 13px;
            text-align: center;
            z-index: 15;
            border: 2px solid #64B5F6;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .spark {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            animation: sparkle 1.2s ease-out forwards;
        }

        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(4) rotate(360deg) translate(60px); opacity: 0; }
        }

        @keyframes playerKick {
            0% { transform: translateY(-50%) rotate(0deg); }
            30% { transform: translateY(-50%) rotate(15deg) scale(1.15); }
            100% { transform: translateY(-50%) rotate(0deg); }
        }

        .kicking {
            animation: playerKick 0.4s ease;
        }

        @keyframes ballSpin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(720deg); }
        }

        .spinning {
            animation: ballSpin 0.8s ease-out;
        }

        .opponent {
            position: absolute;
            width: 35px;
            height: 35px;
            background: linear-gradient(145deg, #FF5722, #FF7043);
            border-radius: 50% 50% 40% 40%;
            border: 2px solid #BF360C;
            z-index: 8;
            transition: all 0.3s ease;
        }

        .opponent::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 8px;
            width: 16px;
            height: 10px;
            background: #5D4037;
            border-radius: 50%;
        }

        .defender {
            position: absolute;
            width: 38px;
            height: 38px;
            background: linear-gradient(145deg, #8E24AA, #9C27B0);
            border-radius: 50% 50% 40% 40%;
            border: 3px solid #4A148C;
            z-index: 8;
            transition: all 0.3s ease;
        }

        .defender::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 9px;
            width: 18px;
            height: 12px;
            background: #3E2723;
            border-radius: 50%;
        }

        .defender::after {
            content: '🛡️';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
        }

        .defender-aggressive {
            animation: defenderCharge 0.8s ease;
        }

        @keyframes defenderCharge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1); }
        }

        @media (max-width: 480px) {
            #playerCard {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            #score {
                font-size: 16px;
                padding: 8px 15px;
            }
            
            #celebration {
                font-size: 20px;
                padding: 20px 25px;
                max-width: 85%;
            }
        }

        @media (max-height: 600px) {
            #arrowControls {
                bottom: 40px;
                width: 130px;
                height: 130px;
            }
            
            .arrow-btn {
                width: 42px;
                height: 42px;
                font-size: 20px;
            }
            
            #kickBtn {
                bottom: 40px;
                width: 75px;
                height: 75px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="field"></div>
        <div id="centerCircle"></div>
        <div id="centerDot"></div>
        <div id="goal">
            <div id="goalPost1"></div>
            <div id="goalPost2"></div>
        </div>
        <div id="goalkeeper"></div>
        <div id="player"></div>
        <div id="ball"></div>
        
        <div id="topUI">
            <div id="score">⚽ Goles: 0</div>
            <div id="playerCard">
                <div style="font-size: 16px;">MATEO GIL</div>
                <div style="font-size: 11px; margin-top: 2px;">🌟 EL PEQUEÑO MESSI 🌟</div>
            </div>
        </div>

        <div id="arrowControls">
            <div class="arrow-btn" id="upBtn">↑</div>
            <div class="arrow-btn" id="leftBtn">←</div>
            <div class="arrow-btn" id="rightBtn">→</div>
            <div class="arrow-btn" id="downBtn">↓</div>
        </div>

        <div id="kickBtn">
            DISPARAR<br>⚽
        </div>

        <div id="messiFacts">
            <strong>🎯 Mateo Gil en acción:</strong> <span id="factText">¡Usa las flechas para mover y el botón rojo para disparar!</span>
        </div>

        <div id="celebration">
            ¡GOLAZO DE MATEO GIL!<br>
            <div style="font-size: 16px; margin-top: 8px;">🌟 ¡Increíble gol contra todos los defensas! 🌟</div>
        </div>
    </div>

    <script>
        // Variables globales
        const player = document.getElementById('player');
        const ball = document.getElementById('ball');
        const goal = document.getElementById('goal');
        const goalkeeper = document.getElementById('goalkeeper');
        const scoreElement = document.getElementById('score');
        const celebration = document.getElementById('celebration');
        const factText = document.getElementById('factText');
        
        // Botones de control
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const kickBtn = document.getElementById('kickBtn');

        let playerPos = { x: 80, y: window.innerHeight / 2 };
        let ballPos = { x: 100, y: window.innerHeight / 2 };
        let goalkeeperPos = { x: window.innerWidth - 50, y: window.innerHeight / 2 };
        let goalkeeperDirection = 1;
        let goalkeeperSpeed = 8; // Aumenté la velocidad base de 5 a 8
        let score = 0;
        let ballVelocity = { x: 0, y: 0 };
        let activeDirections = { up: false, down: false, left: false, right: false };
        let opponents = [];
        let defenders = [];
        let gameRunning = false;

        const messiFacts = [
            "¡Mateo contra el SÚPER PORTERO!",
            "¡Este portero para TODO!",
            "¡El portero legendario está activo!",
            "¡Encuentra el ángulo perfecto!",
            "¡El portero predice tus movimientos!",
            "¡Dispara más rápido para sorprenderlo!",
            "¡El portero cubre toda la portería!",
            "¡Es el portero más difícil del mundo!"
        ];

        // SISTEMA DE CONTROLES SIMPLE Y FUNCIONAL
        function initControls() {
            console.log("Inicializando controles simples...");

            // MOVIMIENTO ARRIBA
            upBtn.onmousedown = function() {
                activeDirections.up = true;
                upBtn.classList.add('pressed');
                console.log('ARRIBA activado');
            };
            upBtn.onmouseup = function() {
                activeDirections.up = false;
                upBtn.classList.remove('pressed');
            };
            upBtn.ontouchstart = function(e) {
                e.preventDefault();
                activeDirections.up = true;
                upBtn.classList.add('pressed');
                console.log('ARRIBA activado (touch)');
            };
            upBtn.ontouchend = function(e) {
                e.preventDefault();
                activeDirections.up = false;
                upBtn.classList.remove('pressed');
            };

            // MOVIMIENTO ABAJO
            downBtn.onmousedown = function() {
                activeDirections.down = true;
                downBtn.classList.add('pressed');
                console.log('ABAJO activado');
            };
            downBtn.onmouseup = function() {
                activeDirections.down = false;
                downBtn.classList.remove('pressed');
            };
            downBtn.ontouchstart = function(e) {
                e.preventDefault();
                activeDirections.down = true;
                downBtn.classList.add('pressed');
                console.log('ABAJO activado (touch)');
            };
            downBtn.ontouchend = function(e) {
                e.preventDefault();
                activeDirections.down = false;
                downBtn.classList.remove('pressed');
            };

            // MOVIMIENTO IZQUIERDA
            leftBtn.onmousedown = function() {
                activeDirections.left = true;
                leftBtn.classList.add('pressed');
                console.log('IZQUIERDA activado');
            };
            leftBtn.onmouseup = function() {
                activeDirections.left = false;
                leftBtn.classList.remove('pressed');
            };
            leftBtn.ontouchstart = function(e) {
                e.preventDefault();
                activeDirections.left = true;
                leftBtn.classList.add('pressed');
                console.log('IZQUIERDA activado (touch)');
            };
            leftBtn.ontouchend = function(e) {
                e.preventDefault();
                activeDirections.left = false;
                leftBtn.classList.remove('pressed');
            };

            // MOVIMIENTO DERECHA
            rightBtn.onmousedown = function() {
                activeDirections.right = true;
                rightBtn.classList.add('pressed');
                console.log('DERECHA activado');
            };
            rightBtn.onmouseup = function() {
                activeDirections.right = false;
                rightBtn.classList.remove('pressed');
            };
            rightBtn.ontouchstart = function(e) {
                e.preventDefault();
                activeDirections.right = true;
                rightBtn.classList.add('pressed');
                console.log('DERECHA activado (touch)');
            };
            rightBtn.ontouchend = function(e) {
                e.preventDefault();
                activeDirections.right = false;
                rightBtn.classList.remove('pressed');
            };

            // BOTÓN DISPARAR
            function shoot() {
                console.log('DISPARO!');
                kickBtn.classList.add('pressed');
                kickBall();
                setTimeout(function() {
                    kickBtn.classList.remove('pressed');
                }, 200);
            }

            kickBtn.onmousedown = shoot;
            kickBtn.ontouchstart = function(e) {
                e.preventDefault();
                shoot();
            };
            kickBtn.onclick = shoot;

            // TECLADO
            document.onkeydown = function(e) {
                if (e.key === 'w' || e.key === 'W' || e.key === 'ArrowUp') {
                    activeDirections.up = true;
                    upBtn.classList.add('pressed');
                }
                if (e.key === 's' || e.key === 'S' || e.key === 'ArrowDown') {
                    activeDirections.down = true;
                    downBtn.classList.add('pressed');
                }
                if (e.key === 'a' || e.key === 'A' || e.key === 'ArrowLeft') {
                    activeDirections.left = true;
                    leftBtn.classList.add('pressed');
                }
                if (e.key === 'd' || e.key === 'D' || e.key === 'ArrowRight') {
                    activeDirections.right = true;
                    rightBtn.classList.add('pressed');
                }
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    shoot();
                }
            };

            document.onkeyup = function(e) {
                if (e.key === 'w' || e.key === 'W' || e.key === 'ArrowUp') {
                    activeDirections.up = false;
                    upBtn.classList.remove('pressed');
                }
                if (e.key === 's' || e.key === 'S' || e.key === 'ArrowDown') {
                    activeDirections.down = false;
                    downBtn.classList.remove('pressed');
                }
                if (e.key === 'a' || e.key === 'A' || e.key === 'ArrowLeft') {
                    activeDirections.left = false;
                    leftBtn.classList.remove('pressed');
                }
                if (e.key === 'd' || e.key === 'D' || e.key === 'ArrowRight') {
                    activeDirections.right = false;
                    rightBtn.classList.remove('pressed');
                }
            };

            // Limpiar al soltar mouse
            document.onmouseup = function() {
                activeDirections.up = false;
                activeDirections.down = false;
                activeDirections.left = false;
                activeDirections.right = false;
                upBtn.classList.remove('pressed');
                downBtn.classList.remove('pressed');
                leftBtn.classList.remove('pressed');
                rightBtn.classList.remove('pressed');
            };

            console.log("Controles inicializados correctamente");
        }

        // Posicionar elementos iniciales
        function initGame() {
            updatePlayerPosition();
            updateBallPosition();
            updateGoalkeeperPosition();
            createOpponents();
            createDefenders();
            initControls();
            gameRunning = true;
            gameLoop();
            console.log("Juego inicializado");
        }

        function updatePlayerPosition() {
            player.style.left = playerPos.x + 'px';
            player.style.top = playerPos.y + 'px';
        }

        function updateBallPosition() {
            ball.style.left = ballPos.x + 'px';
            ball.style.top = ballPos.y + 'px';
        }

        function updateGoalkeeperPosition() {
            goalkeeper.style.left = goalkeeperPos.x + 'px';
            goalkeeper.style.top = goalkeeperPos.y + 'px';
        }

        function moveGoalkeeper() {
            // PORTERO SÚPER INTELIGENTE Y DIFÍCIL
            const ballDistance = Math.sqrt(
                Math.pow(ballPos.x - goalkeeperPos.x, 2) + 
                Math.pow(ballPos.y - goalkeeperPos.y, 2)
            );
            
            const playerDistance = Math.sqrt(
                Math.pow(playerPos.x - goalkeeperPos.x, 2) + 
                Math.pow(playerPos.y - goalkeeperPos.y, 2)
            );
            
            // COMPORTAMIENTO PREDICTIVO: El portero predice hacia dónde va el balón
            if (ballDistance < 300 && ballVelocity.x > 2) {
                // Predecir la posición futura del balón
                const futureBallY = ballPos.y + (ballVelocity.y * 5);
                
                if (futureBallY < goalkeeperPos.y - 10) {
                    goalkeeperDirection = -1;
                    goalkeeperSpeed = 12; // MUY RÁPIDO
                } else if (futureBallY > goalkeeperPos.y + 10) {
                    goalkeeperDirection = 1;
                    goalkeeperSpeed = 12; // MUY RÁPIDO
                } else {
                    goalkeeperSpeed = 6; // Se posiciona
                }
            } 
            // COMPORTAMIENTO DEFENSIVO: Sigue al jugador cuando está cerca
            else if (playerDistance < 400) {
                if (playerPos.y < goalkeeperPos.y - 15) {
                    goalkeeperDirection = -1;
                    goalkeeperSpeed = 8;
                } else if (playerPos.y > goalkeeperPos.y + 15) {
                    goalkeeperDirection = 1;
                    goalkeeperSpeed = 8;
                } else {
                    goalkeeperSpeed = 4; // Mantiene posición
                }
            }
            // COMPORTAMIENTO NORMAL: Patrullaje constante
            else {
                goalkeeperSpeed = 6; // Velocidad base más alta
            }
            
            goalkeeperPos.y += goalkeeperDirection * goalkeeperSpeed;
            
            // Límites de movimiento más amplios - cubre más área
            const goalTop = window.innerHeight/2 - 120;
            const goalBottom = window.innerHeight/2 + 120;
            
            if (goalkeeperPos.y <= goalTop || goalkeeperPos.y >= goalBottom) {
                goalkeeperDirection *= -1;
            }
            
            updateGoalkeeperPosition();
        }

        function createOpponents() {
            for (let i = 0; i < 5; i++) {
                const opponent = document.createElement('div');
                opponent.className = 'opponent';
                opponent.style.left = (200 + i * 120) + 'px';
                opponent.style.top = (100 + i * 80) + 'px';
                document.getElementById('gameContainer').appendChild(opponent);
                opponents.push({
                    element: opponent,
                    x: 200 + i * 120,
                    y: 100 + i * 80,
                    direction: Math.random() > 0.5 ? 1 : -1,
                    speed: 2 + Math.random() * 2
                });
            }
        }

        function createDefenders() {
            for (let i = 0; i < 6; i++) {
                const defender = document.createElement('div');
                defender.className = 'defender';
                defender.style.left = (window.innerWidth - 200 - i * 80) + 'px';
                defender.style.top = (80 + i * 60) + 'px';
                document.getElementById('gameContainer').appendChild(defender);
                defenders.push({
                    element: defender,
                    x: window.innerWidth - 200 - i * 80,
                    y: 80 + i * 60,
                    direction: Math.random() > 0.5 ? 1 : -1,
                    speed: 3 + Math.random() * 2,
                    lastPlayerDistance: 1000,
                    aggressionCooldown: 0
                });
            }
        }

        function animateOpponents() {
            opponents.forEach(opp => {
                opp.y += opp.direction * opp.speed;
                if (opp.y <= 50 || opp.y >= window.innerHeight - 80) {
                    opp.direction *= -1;
                }
                opp.element.style.top = opp.y + 'px';
            });
        }

        function animateDefenders() {
            defenders.forEach(def => {
                const playerDistance = Math.sqrt(
                    Math.pow(playerPos.x - def.x, 2) + 
                    Math.pow(playerPos.y - def.y, 2)
                );
                
                if (playerDistance < 150 && def.aggressionCooldown <= 0) {
                    def.element.classList.add('defender-aggressive');
                    def.aggressionCooldown = 60;
                    
                    if (playerPos.x < def.x) def.x -= def.speed * 2;
                    if (playerPos.y < def.y) def.y -= def.speed;
                    else def.y += def.speed;
                    
                    setTimeout(() => {
                        def.element.classList.remove('defender-aggressive');
                    }, 800);
                } else {
                    def.y += def.direction * def.speed;
                    if (def.y <= 50 || def.y >= window.innerHeight - 80) {
                        def.direction *= -1;
                    }
                }
                
                if (def.aggressionCooldown > 0) def.aggressionCooldown--;
                
                def.element.style.left = def.x + 'px';
                def.element.style.top = def.y + 'px';
                def.lastPlayerDistance = playerDistance;
            });
        }

        function checkDefenderCollisions() {
            const playerBuffer = 45;
            
            defenders.forEach(def => {
                const distance = Math.sqrt(
                    Math.pow(playerPos.x - def.x, 2) + 
                    Math.pow(playerPos.y - def.y, 2)
                );
                
                if (distance < playerBuffer) {
                    const angle = Math.atan2(playerPos.y - def.y, playerPos.x - def.x);
                    playerPos.x += Math.cos(angle) * 3;
                    playerPos.y += Math.sin(angle) * 3;
                    
                    factText.textContent = "¡Los defensas están marcando muy de cerca a Mateo!";
                    
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                }
            });
        }

        function movePlayer() {
            const speed = 5;
            
            if (activeDirections.up && playerPos.y > 25) {
                playerPos.y -= speed;
            }
            if (activeDirections.down && playerPos.y < window.innerHeight - 65) {
                playerPos.y += speed;
            }
            if (activeDirections.left && playerPos.x > 25) {
                playerPos.x -= speed;
            }
            if (activeDirections.right && playerPos.x < window.innerWidth - 65) {
                playerPos.x += speed;
            }
            
            checkDefenderCollisions();
            updatePlayerPosition();
            
            const distance = Math.sqrt(
                Math.pow(playerPos.x - ballPos.x, 2) + 
                Math.pow(playerPos.y - ballPos.y, 2)
            );
            
            if (distance < 65) {
                const angle = Math.atan2(ballPos.y - playerPos.y, ballPos.x - playerPos.x);
                ballPos.x = playerPos.x + Math.cos(angle) * 60;
                ballPos.y = playerPos.y + Math.sin(angle) * 60;
                updateBallPosition();
                
                if (distance < 80) {
                    kickBtn.classList.add('ready');
                    kickBtn.innerHTML = '¡DISPARA!<br>⚽';
                } else {
                    kickBtn.classList.remove('ready');
                    kickBtn.innerHTML = 'DISPARAR<br>⚽';
                }
            } else {
                kickBtn.classList.remove('ready');
                kickBtn.innerHTML = 'DISPARAR<br>⚽';
            }
        }

        function kickBall() {
            const distance = Math.sqrt(
                Math.pow(playerPos.x - ballPos.x, 2) + 
                Math.pow(playerPos.y - ballPos.y, 2)
            );
            
            console.log("Distancia al balón:", distance);
            
            if (distance < 80) {
                player.classList.add('kicking');
                ball.classList.add('spinning');
                
                setTimeout(() => {
                    player.classList.remove('kicking');
                    ball.classList.remove('spinning');
                }, 400);
                
                const goalX = window.innerWidth - 30;
                const goalY = window.innerHeight / 2;
                
                const angle = Math.atan2(goalY - ballPos.y, goalX - ballPos.x);
                ballVelocity.x = Math.cos(angle) * 18;
                ballVelocity.y = Math.sin(angle) * 18;
                
                console.log("¡Disparo realizado!");
                
                animateBall();
                
                factText.textContent = messiFacts[Math.floor(Math.random() * messiFacts.length)];
                
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            } else {
                factText.textContent = "¡Acércate más al balón para disparar, Mateo!";
                console.log("Muy lejos del balón");
            }
        }

        function animateBall() {
            ballPos.x += ballVelocity.x;
            ballPos.y += ballVelocity.y;
            
            if (ballPos.y <= 20 || ballPos.y >= window.innerHeight - 42) {
                ballVelocity.y *= -0.75;
                ballPos.y = Math.max(20, Math.min(window.innerHeight - 42, ballPos.y));
            }
            
            if (ballPos.x <= 20) {
                ballVelocity.x *= -0.75;
                ballPos.x = 20;
            }
            
            defenders.forEach(def => {
                const defenderDistance = Math.sqrt(
                    Math.pow(ballPos.x - def.x, 2) + 
                    Math.pow(ballPos.y - def.y, 2)
                );
                
                if (defenderDistance < 35 && ballVelocity.x > 0) {
                    def.element.classList.add('defender-aggressive');
                    setTimeout(() => def.element.classList.remove('defender-aggressive'), 600);
                    
                    ballVelocity.x *= -0.7;
                    ballVelocity.y *= 0.4;
                    
                    factText.textContent = "¡Un defensa interceptó el balón! ¡Recupera y sigue, Mateo!";
                    
                    if (navigator.vibrate) {
                        navigator.vibrate([80, 40, 80]);
                    }
                }
            });
            
            // Verificar colisión con el portero (SÚPER DIFÍCIL)
            const distanceToGoalkeeper = Math.sqrt(
                Math.pow(ballPos.x - goalkeeperPos.x, 2) + 
                Math.pow(ballPos.y - goalkeeperPos.y, 2)
            );
            
            if (distanceToGoalkeeper < 60 && ballVelocity.x > 0) {
                const saveChance = Math.random();
                const ballSpeed = Math.abs(ballVelocity.x) + Math.abs(ballVelocity.y);
                
                // El portero es MÁS EFECTIVO contra disparos más lentos
                let saveRate = 0.85; // 85% de paradas base
                
                if (ballSpeed > 25) {
                    saveRate = 0.65; // Disparos muy rápidos son más difíciles de parar
                } else if (ballSpeed > 20) {
                    saveRate = 0.75; // Disparos rápidos
                } else {
                    saveRate = 0.90; // Disparos lentos casi siempre los para
                }
                
                if (saveChance < saveRate) {
                    // TIPOS DE PARADAS SEGÚN LA SITUACIÓN
                    if (saveChance < 0.3) {
                        // PARADA LEGENDARIA (30% de las veces)
                        goalkeeper.classList.add('goalkeeper-legendary');
                        setTimeout(() => goalkeeper.classList.remove('goalkeeper-legendary'), 800);
                        
                        ballVelocity.x *= -1.5; // Rebote fuerte
                        ballVelocity.y *= 1.2;
                        
                        factText.textContent = "¡PARADA LEGENDARIA! ¡Este portero es imparable!";
                        
                        // Vibración épica
                        if (navigator.vibrate) {
                            navigator.vibrate([150, 50, 150, 50, 150]);
                        }
                    } else if (saveChance < 0.6) {
                        // SÚPER PARADA (30% adicional)
                        goalkeeper.classList.add('goalkeeper-super-save');
                        setTimeout(() => goalkeeper.classList.remove('goalkeeper-super-save'), 500);
                        
                        ballVelocity.x *= -1.3;
                        ballVelocity.y *= 1.0;
                        
                        factText.textContent = "¡SÚPER PARADA! ¡El portero vuela por toda la portería!";
                        
                        if (navigator.vibrate) {
                            navigator.vibrate([120, 60, 120]);
                        }
                    } else {
                        // PARADA NORMAL (resto de las veces)
                        goalkeeper.classList.add('goalkeeper-dive');
                        setTimeout(() => goalkeeper.classList.remove('goalkeeper-dive'), 300);
                        
                        ballVelocity.x *= -1.1;
                        ballVelocity.y *= 0.8;
                        
                        factText.textContent = "¡Parada del portero! ¡Es muy difícil superarlo!";
                        
                        if (navigator.vibrate) {
                            navigator.vibrate([100, 50, 100]);
                        }
                    }
                } else {
                    // El portero NO pudo parar (muy raro)
                    factText.textContent = "¡El portero no pudo llegar! ¡Sigue hacia la portería!";
                }
            }
            
            const goalRight = window.innerWidth - 55;
            const goalTop = window.innerHeight/2 - 50;
            const goalBottom = window.innerHeight/2 + 50;
            
            if (ballPos.x >= goalRight && ballPos.y >= goalTop && ballPos.y <= goalBottom) {
                goalScored();
                return;
            }
            
            if (ballPos.x >= window.innerWidth - 25 || 
                (Math.abs(ballVelocity.x) < 0.8 && Math.abs(ballVelocity.y) < 0.8)) {
                ballVelocity.x = 0;
                ballVelocity.y = 0;
                return;
            }
            
            ballVelocity.x *= 0.985;
            ballVelocity.y *= 0.985;
            
            updateBallPosition();
            
            if (Math.abs(ballVelocity.x) > 0.2 || Math.abs(ballVelocity.y) > 0.2) {
                requestAnimationFrame(animateBall);
            }
        }

        function goalScored() {
            score++;
            scoreElement.textContent = `⚽ Goles: ${score}`;
            
            celebration.style.display = 'block';
            
            createFireworks();
            
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            
            setTimeout(() => {
                celebration.style.display = 'none';
                resetBall();
                increaseDifficulty();
            }, 3000);
        }

        function increaseDifficulty() {
            // El portero se vuelve AÚN MÁS DIFÍCIL con cada gol
            goalkeeperSpeed += 1; // Aumenta más la velocidad
            
            // Los defensas también mejoran
            defenders.forEach(def => {
                def.speed += 0.4;
                def.aggressionCooldown = Math.max(15, def.aggressionCooldown - 8);
            });
            
            // Mensajes según el nivel de dificultad
            if (score >= 5) {
                factText.textContent = "¡MODO IMPOSIBLE! ¡El portero es una leyenda viviente!";
            } else if (score >= 3) {
                factText.textContent = "¡MODO EXTREMO! ¡El portero está en su mejor forma!";
            } else {
                factText.textContent = "¡El portero se vuelve más difícil! ¡Mateo debe ser más astuto!";
            }
        }

        function createFireworks() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const spark = document.createElement('div');
                    spark.className = 'spark';
                    spark.style.left = (window.innerWidth - 80 + Math.random() * 60) + 'px';
                    spark.style.top = (window.innerHeight/2 + Math.random() * 80 - 40) + 'px';
                    spark.style.background = ['#FFD700', '#FF6B35', '#4CAF50', '#2196F3', '#9C27B0'][Math.floor(Math.random() * 5)];
                    document.body.appendChild(spark);
                    
                    setTimeout(() => spark.remove(), 1200);
                }, i * 40);
            }
        }

        function resetBall() {
            ballPos.x = 100;
            ballPos.y = window.innerHeight / 2;
            ballVelocity.x = 0;
            ballVelocity.y = 0;
            updateBallPosition();
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            movePlayer();
            moveGoalkeeper();
            animateOpponents();
            animateDefenders();
            requestAnimationFrame(gameLoop);
        }

        // Mensajes motivacionales periódicos
        setInterval(() => {
            if (gameRunning) {
                factText.textContent = messiFacts[Math.floor(Math.random() * messiFacts.length)];
            }
        }, 8000);

        // Ajustar al rotar dispositivo
        window.addEventListener('resize', () => {
            playerPos.y = Math.min(playerPos.y, window.innerHeight - 65);
            ballPos.y = Math.min(ballPos.y, window.innerHeight - 42);
            goalkeeperPos.x = window.innerWidth - 50;
            goalkeeperPos.y = Math.min(goalkeeperPos.y, window.innerHeight - 65);
            
            updatePlayerPosition();
            updateBallPosition();
            updateGoalkeeperPosition();
            
            opponents.forEach((opp, index) => {
                opp.y = Math.min(opp.y, window.innerHeight - 80);
                opp.element.style.top = opp.y + 'px';
            });
            
            defenders.forEach((def, index) => {
                def.y = Math.min(def.y, window.innerHeight - 80);
                def.x = Math.max(window.innerWidth - 300, def.x);
                def.element.style.top = def.y + 'px';
                def.element.style.left = def.x + 'px';
            });
        });

        // Prevenir comportamientos por defecto
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // Mensaje inicial
        setTimeout(() => {
            factText.textContent = "¡Mantén presionadas las flechas para mover y toca el botón rojo para disparar!";
        }, 2000);

        // INICIAR EL JUEGO
        window.addEventListener('load', () => {
            console.log("Página cargada, iniciando juego...");
            initGame();
        });

        // También iniciar inmediatamente por si acaso
        if (document.readyState === 'complete') {
            console.log("Documento ya listo, iniciando juego...");
            initGame();
        }
    </script>
</body>
</html>